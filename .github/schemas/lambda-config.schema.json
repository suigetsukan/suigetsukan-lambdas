{"$schema":"http://json-schema.org/draft-07/schema#","title":"Suigetsukan Lambda Config","type":"object","required":["function_name_suffix"],"properties":{"function_name_suffix":{"type":"string","minLength":1,"pattern":"^[a-z0-9-]+$"},"function_name":{"type":"string","pattern":"^suigetsukan-[a-z0-9-]+$"},"role_name":{"type":"string","pattern":"^suigetsukan-[a-z0-9-]+-role$"},"handler":{"type":"string","default":"app.lambda_handler"},"runtime":{"type":"string","enum":["python3.11","python3.12"],"default":"python3.11"},"timeout":{"type":"integer","minimum":1,"maximum":900,"default":300},"memory_size":{"type":"integer","enum":[128,256,512,1024,2048,3072,4096,5120,6144,7168,8192,9216,10240],"default":256},"env_vars":{"type":"object","additionalProperties":{"type":"string"}},"optional_env_vars":{"type":"array","items":{"type":"string"},"description":"Env var keys (case-insensitive) that may be omitted; deploy won't fail if unresolved.","default":[]},"layers":{"type":"array","items":{"type":"string"},"default":[]},"exclude_files":{"type":"array","items":{"type":"string"},"default":["*.pyc","__pycache__/*","tests/**"]},"event_sources":{"type":"array","items":{"type":"object","required":["type"],"properties":{"type":{"type":"string","enum":["sqs","eventbridge","iot-rule"]},"arn":{"type":"string"},"batch_size":{"type":"integer","minimum":1,"maximum":10000},"event_pattern":{"type":"string","description":"JSON event pattern for EventBridge rules (required for event-based rules)."},"schedule_expression":{"type":"string","description":"Cron or rate expression for scheduled EventBridge rules (e.g. rate(1 day), cron(0 12 * * ? *))."},"rule_name":{"type":"string","description":"Custom name for the EventBridge rule (optional for type='eventbridge'; defaults to 'suigetsukan-{function_name_suffix}-Rule')."},"topic":{"type":"string","description":"MQTT topic for IoT Rule (required for type='iot-rule')."},"actions":{"type":"array","items":{"type":"object","required":["type","function_name"],"properties":{"type":{"const":"lambda"},"function_name":{"type":"string"}}},"description":"Actions for IoT Rule (required for type='iot-rule')."}},"allOf":[{"if":{"properties":{"type":{"enum":["sqs","eventbridge"]}}},"then":{"required":["arn"]}},{"if":{"properties":{"type":{"const":"eventbridge"}}},"then":{"oneOf":[{"required":["event_pattern"]},{"required":["schedule_expression"]}]}},{"if":{"properties":{"type":{"const":"iot-rule"}}},"then":{"required":["topic","actions"]}}],"additionalProperties":false},"default":[]},"tags":{"type":"object","additionalProperties":{"type":"string"},"default":{}}},"additionalProperties":true}
